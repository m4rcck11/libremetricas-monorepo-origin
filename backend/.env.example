# ================================================================================
# LibreMétricas Backend - Environment Variables Configuration
# ================================================================================
#
# Este arquivo contém TODAS as variáveis de ambiente necessárias para rodar:
# - API FastAPI (app/)
# - Scripts de processamento e sincronização de dados (tools/)
#
# INSTRUÇÕES DE USO:
# 1. Copie este arquivo: cp .env.example .env
# 2. Ajuste os valores conforme seu ambiente
# 3. Nunca commite o arquivo .env (já está no .gitignore)
#
# VARIÁVEIS OBRIGATÓRIAS vs OPCIONAIS:
# - [OBRIGATÓRIO] = Necessário para funcionamento básico
# - [OPCIONAL] = Funcionalidade extra ou já tem valor padrão sensato
#
# ================================================================================

# ================================================================================
# 1. APPLICATION CONFIGURATION
# ================================================================================

# Nome da aplicação
APP_NAME=LibreMétricas

# Versão da API (deve bater com app/config.py)
APP_VERSION=0.1

# Modo debug (use false em produção) [OBRIGATÓRIO]
DEBUG=false

# ================================================================================
# 2. DATABASE & STORAGE CONFIGURATION
# ================================================================================

# Diretório base para dados Parquet e DuckDB [OBRIGATÓRIO]
# Em Docker: /app/data (volume montado)
# Em desenvolvimento local: ../data ou caminho absoluto
DATA_DIR=/app/data

# Caminho para arquivo DuckDB (usado para cache de queries) [OBRIGATÓRIO]
DUCKDB_PATH=/app/data/analytics.duckdb

# Diretório com arquivos Parquet (normalmente igual a DATA_DIR) [OPCIONAL]
# Se não definido, usa DATA_DIR
PARQUET_DIR=/app/data

# ================================================================================
# 3. GOOGLE CLOUD STORAGE (para scripts de sincronização)
# ================================================================================

# Nome do bucket GCS público com dados OpenAlex LATAM [OBRIGATÓRIO para sync]
GCS_BUCKET_NAME=altmetria_latam_ibict_tables

# Prefixo de pasta dentro do bucket (deixe vazio se não houver) [OPCIONAL]
GCS_FOLDER_PREFIX=

# Diretório local para download de arquivos do GCS [OBRIGATÓRIO para sync]
LOCAL_DOWNLOAD_PATH=/app/data

# ================================================================================
# 4. PERFORMANCE & RETRY CONFIGURATION
# ================================================================================

# Número de linhas por batch ao processar dados [OPCIONAL]
CHUNK_SIZE=50000

# Tamanho do chunk para download de arquivos (bytes) [OPCIONAL]
DOWNLOAD_CHUNK_SIZE=8192

# Número máximo de tentativas em caso de falha [OPCIONAL]
MAX_RETRIES=3

# Segundos de backoff exponencial entre tentativas [OPCIONAL]
RETRY_BACKOFF=2

# Timeout para requisições HTTP em segundos (5 minutos) [OPCIONAL]
REQUEST_TIMEOUT=300

# ================================================================================
# 5. LOGGING & NOTIFICATIONS
# ================================================================================

# Arquivo de log para scripts de processamento [OPCIONAL]
LOG_FILE=import_biblio.log

# Nível de logging: DEBUG, INFO, WARNING, ERROR, CRITICAL [OPCIONAL]
LOG_LEVEL=INFO

# URL para webhook de notificações (ex: Slack, Discord) [OPCIONAL]
# Deixe vazio se não usar
WEBHOOK_URL=

# Email para receber notificações de erro [OPCIONAL]
NOTIFICATION_EMAIL=

# Limpar arquivos temporários após importação [OPCIONAL]
CLEANUP_AFTER_IMPORT=true

# ================================================================================
# 6. EXTERNAL APIs
# ================================================================================

# ---------------------------
# Crossref Event Data API
# ---------------------------

# Email de contato (OBRIGATÓRIO pela política da API Crossref)
# Usar email real para compliance com termos de uso
CROSSREF_MAILTO=seu-email@exemplo.com

# Linhas retornadas por requisição à API Crossref [OPCIONAL]
CROSSREF_ROWS_PER_REQUEST=200

# Delay entre requisições em segundos (respeitar rate limit) [OPCIONAL]
CROSSREF_REQUEST_DELAY=1.0

# ================================================================================
# 7. BLUESKY CONFIGURATION (Opcional - Coleta de eventos Bluesky)
# ================================================================================

# Diretório alternativo para saída de eventos Bluesky [OPCIONAL]
# Se vazio, usa DATA_DIR/events/raw/bluesky
BLUESKY_OUTPUT_DIR=

# ================================================================================
# 8. MYSQL CONFIGURATION (Opcional - Desabilitado por padrão)
# ================================================================================
# A API usa DuckDB por padrão. MySQL é opcional para export de dados.

# Habilitar exportação para MySQL [OPCIONAL]
ENABLE_MYSQL_IMPORT=false

# Host do servidor MySQL [OPCIONAL - só necessário se ENABLE_MYSQL_IMPORT=true]
MYSQL_HOST=localhost

# Porta do MySQL [OPCIONAL]
MYSQL_PORT=3306

# Nome do database [OPCIONAL]
MYSQL_DATABASE=openalex_latam

# Usuário MySQL [OPCIONAL]
MYSQL_USER=root

# Senha MySQL [OPCIONAL]
# ⚠️ SEGURANÇA: Nunca commite senhas reais no repositório
MYSQL_PASSWORD=

# ================================================================================
# 9. ALIBABA CLOUD OSS (Opcional - para backup/storage em OSS)
# ================================================================================

# Access Key ID para Alibaba Cloud OSS [OPCIONAL]
# Necessário apenas se usar upload de backups para OSS
OSS_ACCESS_KEY_ID=

# Access Key Secret para Alibaba Cloud OSS [OPCIONAL]
# ⚠️ SEGURANÇA: Mantenha este valor secreto
OSS_ACCESS_KEY_SECRET=

# ================================================================================
# 10. RATE LIMITING
# ================================================================================

# Habilitar rate limiting global [OBRIGATÓRIO]
RATE_LIMIT_ENABLED=true

# Requisições por minuto para endpoints normais [OPCIONAL]
RATE_LIMIT_PER_MINUTE=100

# Requisições por minuto para endpoints pesados (SELECT *, exports) [OPCIONAL]
RATE_LIMIT_PER_MINUTE_HEAVY=10

# ================================================================================
# 11. CORS CONFIGURATION
# ================================================================================

# Origens permitidas para CORS [OBRIGATÓRIO]
# ⚠️ SEGURANÇA: NÃO USE "*" EM PRODUÇÃO!
# Desenvolvimento: ["http://localhost:3000", "http://localhost:5173"]
# Produção: ["https://seu-dominio.com"]
CORS_ORIGINS=["http://localhost:3000","http://localhost:5173"]

# Permitir credenciais (cookies, auth headers) [OPCIONAL]
CORS_ALLOW_CREDENTIALS=true

# Métodos HTTP permitidos [OPCIONAL]
CORS_ALLOW_METHODS=["GET","POST","OPTIONS"]

# Headers permitidos [OPCIONAL]
CORS_ALLOW_HEADERS=["*"]

# ================================================================================
# 12. QUERY CACHE
# ================================================================================

# Habilitar cache de queries em memória [OPCIONAL]
CACHE_ENABLED=true

# Tempo de vida do cache em segundos (5 minutos) [OPCIONAL]
CACHE_TTL_SECONDS=300

# Número máximo de itens em cache [OPCIONAL]
CACHE_MAX_SIZE=128

# ================================================================================
# 13. SERVER CONFIGURATION
# ================================================================================

# Host para bind do servidor [OBRIGATÓRIO]
# 0.0.0.0 = aceita conexões de qualquer interface
# 127.0.0.1 = apenas localhost
HOST=0.0.0.0

# Porta do servidor [OBRIGATÓRIO]
PORT=8000

# Número de workers Gunicorn (ajustar conforme CPU disponível) [OPCIONAL]
# Recomendado: (2 x num_cores) + 1
WORKERS=4
